ROADMAP
1. Fully passing DMC tests
2. Fully working MMC5
3. Expansion Audio
4. Remaining test ROMs
5. Proper sounding audio

Investigate if lack of MMC5 Extended Ram CHR status register is causing bad renders.
Re-allow ReadWriteStatuses for MMC5 Extended RAM.
Add CHR bank viewer. Allow overriding the selected bank for the game rendering.
Remove GetSpritePatternHack in ppu.rs.
Wide pixels.
Move nestest over to new formatting system.
Disable OAMDATA writes (other than address increment) during rendering
Proper encapsulation for PPU registers
Improve cycle accuracy of undocumented instructions
Other input devices.
Auto-mirror undersized CHR (for mapper 99 and maybe others).
Mapper switch dialog for mislabelled ROMs.
Correct PPU address during sprite rendering
Unwrap review. Convert most to expect or Result.
Add {PRG,CHR} rom exact size as layout option?
Detangle Mapper::cpu_read
CPU mode debug screen, including DMAs
Use has_persistent_memory correctly (mostly for cases without NES2.0 metadata)
Why does Sunsoft FME7 (mapper 69) have a holymapperel result of 0010? Mesen behaves the same.
Detect PpuAddress changes better, then clean up MMC3 and Mapper 91 IRQ logic.
Give "Fix Metadata" prompt when metadata doesn't match the DB (Test case: mirroring for Dragon Ball - Shen Long no Nazo, also Fighting Hero)

REWRITES NEEDED
OamAddress probably shouldn't know anything about sprite fields. Should just be a simple u8. Remove sprite 0 determination since that is a property of SecondaryOam (or PPU dot 66).
Low-level PRG address components API.
    PRG locations as "oooo pppp aaaa aaaa"
    Simple case: mapper 235
    Complex case: Action 53
    Unify normal high-level bank handling with this low-level API? Very likely.

Signals-driven refactor.
    Blocked on removing cpu_peek/cpu_read/cpu_write from Mapper
        Blocked on making on_ppu_address_change() and on_ppu_read() signal-based
    Blocked on removing ppu_peek/ppu_internal_read/ppu_write from Mapper
        Blocked on making on_ppu_read() signal-based
        Blocked on mapper 5 and 19 overriding ppu_peek
        Blocked on mapper 19 overriding ppu_write

FANCY NICE-TO-HAVES
APU frequency correction
Allow banks to be configured to pass through PPU address bits, rather than custom logic being needed (see Sachen8259).

POST-RELEASE
Rewrite CPU signals from bottom-up

BUGS
Gracefully handle bad CHR size? ((( Argus (J) [hM03][o2].nes ))) ((( Atlantis no Nazo (J) [hM03][b3].nes )))
Gracefully handle bad PRG size? ((( Boy and His Blob, A - Trouble on Blobolonia (U) [o5].nes )))
(Low priority) What should happen when BankIndex > bank_count when bank_count isn't a power of 2? Open bus?
Arkanoid: Extra sprite.

UNTESTED BY EXISTING TEST ROMS
IRQ behavior for the vast majority of IRQ mappers
Race conditions between is_in_frame_irq_window and $4017 writes

FAILING TESTS
SHX/SXA: https://forums.nesdev.org/viewtopic.php?p=297765

tvpassfail/tv

apu_mixer
dmc_dma_during_read4
dmc_tests

PaddleTest3/PaddleTest

full_palette
full_nes_palette


TRACE LOGGING DISCREPANCIES BETWEEN REZNEZ AND MESEN
Many values that are printed for OpenBus, visible in the logs of almost all ROMs.
Power Rangers III, Cycle:148880, Cycle:446682, (Very long divergence) Cycle:503881 - STA Instruction is printed after IRQ is complete for REZNEZ. Weird NMI/IRQ/branch interactions. Not just a logging issue in one of the emulators.
		   Cycle:206109, Cycle:206680 - REZNEZ experiences a sprite 0 hit, Mesen doesn't. Need to investigate who is right.

---------------------GAMES------------------------------------
MAPPER 0
Cheetah Men II [b1] (Doesn't work on Mesen/nestopia either. Wrong tiles are rendered during some intro screens, probably just a bad ROM hack)

MAPPER 3
Athletic World (Freezes on Mesen/nestopia too. Freezes at the beginning of the Hurdles event)

MAPPER 5
Romance of The Three Kingdoms II - Sprite tiles are used instead of background tiles. Somehow MMC5 is supposed to be reading from the left pattern table even though PPUCTRL specifies the right table for background rendering.
Daikoukai Jidai - Game attempts to write to ROM(?) when pressing SELECT at the beginning of the first level

MAPPER 15
Crazy Climber: Blank screen

MAPPER 67
Fantasy Zone 2 - The Teardrop of Opa-Opa: Flickering scanline during intro (Mesen has the same problem)

MAPPER 69
Batman - Return of the Joker: Flickering pixels in both intro and game (Mesen has the same problem). May be a problem on the actual console.

MAPPER 71
Fire Hawk: Broken name table display.

MAPPER 83, SUBMAPPER 2
Dragon Ball Party: Flickering pixels on one scanline during the battle sequences. Too far into the game to make a test frame.

MAPPER 139
Final Combat: Junk tiles briefly flash during intro. Broken in Mesen too.

MAPPER 141
Q Boy: Need to support CHR RAM (with no CHR shift)

MAPPER 193
Deep Dungeon 4: Accesses CHR RAM outside of the default provided 8KiB. Need mirroring?


Improvements over Mesen:
Magic John - Mesen has two flickering pixels on right hand side during the intro. REZNEZ used to have this, but no longer. IRQ or NMI off-by-two?
Daikoukai\ Jidai - Mesen has flickering pixels a the top left during the initial scroll sequence.


Total games implemented:
000: 247
001: 680
002: 270
003: 155
004: 599
005: 25
007: 75
009: 11
010: 3
011: 34
013: 1

015: 2
016: 15
018: 15
019: 20
020: 0
021: 2
022: 2
023: 10
025: 6
029: 0
032: 6
033: 9
034: 5
037: 3
038: 0
039: 0
041: 1
042: 0
043: 0
046: 0
047: 1
064: 5
065: 3
066: 17
067: 2
069: 15
070: 2
071: 16
073: 1
075: 5
076: 1
078: 2
079: 16
080: 6
082: 5
085: 2
086: 1
087: 10
088: 3
089: 1
093: 2
094: 1
097: 1
101: 0
113: 0
118: 7
119: 8
133: 0
140: 3
141: 1
145: 0
146: 0
148: 0
149: 0
152: 4
154: 1
159: 4
177: 0
180: 1
184: 3
189: 1
193: 2
206: 45
207: 1
210: 12
232: 5
234: 2
240: 0
241: 0

2414 / 2447
